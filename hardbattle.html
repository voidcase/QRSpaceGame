<html>
	<head>
		<title>battle!</title>
		<link rel="stylesheet" type="text/css" href="style.css" />
	</head>
	<body>
		<div class="ship">
			<div id="nameviewer">---</div>
			<div id="laserviewer">---</div>
			<div id="shieldsviewer">---</div>
			<div id="missileviewer">---</div>
			<div id="creditviewer">---</div>
			<div id=input>
				<button onclick=fireLaser()>FIRE LASERS</button>
				<button onclick=fireMissile()>FIRE MISSILE</button>
				<button onclick=raiseShields()>REGENERATE SHIELDS</button>
				<button onclick=scan()>SCAN</button>
			</div>
		</div>
		<div class="outputWindow">
			<p id="output"></p>
		</div>
		<script>
			function output(text){
				var child = document.createTextNode(text);
				var br = document.createElement("br");
				document.getElementById("output").appendChild(child);
				document.getElementById("output").appendChild(br);
			}
			function getCookie(key) {
				var value = "; " + document.cookie;
				var parts = value.split("; " + key + "=");
				if (parts.length == 2) return parts.pop().split(";").shift();
			}

			var name, shields, laser, missiles, credits;
			name = getCookie("name");
			shields = +getCookie("shields");
			laser = +getCookie("laser");
			missiles = +getCookie("missiles");
			credits = +getCookie("credits");
			var maxShields = shields;
			function updateShip(){
				document.getElementById("nameviewer").innerHTML = "<b>" + name + "</b>";
				document.getElementById("laserviewer").innerHTML = "laser: " + laser;
				document.getElementById("shieldsviewer").innerHTML = "shields: " + shields + "/" + maxShields;
				document.getElementById("missileviewer").innerHTML = "missiles: " + missiles;
				document.getElementById("creditviewer").innerHTML = "credits: " + credits;
			}

			if(shields == 0){
				window.location.replace("death.html");
			}

			updateShip();

			function foe(n,l,s,m,c,h){
				this.n = n;
				this.s = s;
				this.l = l;
				this.m = m;
				this.c = c;
				this.h = h;
			}

			var enemies = [
				new foe("Victory Class Star Destroyer",20,15,3,1000,"You will know the power of the dark side"),
				new foe("Imperial Class Star Destroyer",15,20,3,1000,"You are sentenced to immediate execution for crime against the empire."),
				new foe("Dreadnaught Class Heavy Cruiser",15,15,4,600,"The resistance will be crushed!")
			];
			var enemy = enemies[Math.floor(Math.random()*(enemies.length))];
			output("You are ambushed by " + enemy.n + "!");
			output("A message is recieved on the intercom: " + enemy.h);
			output("COMBAT MODE : ENGAGED");
			

			function checkVictory(){
				if(enemy.s<=0){
					output("The " + enemy.n + " got blown to pieces. You stand victorious in battle.");
					output("Looting the debris of the enemy, " + enemy.c + " credits were recovered.");
					shields = maxShields;
					output("shields regenerated to capacity.");
					output("COMBAT MODE : DISENGAGED");
					output("You can now safely hyperdrive to the next location.");
					credits += +enemy.c;
					updateShip();

					document.getElementById("input").style.visibility = "hidden";

					document.cookie = 'missiles=' + missiles + "; path=/";
					document.cookie = 'credits=' + credits + "; path=/";
				}
				else{
					retaliation();
				}
			}
			
			function fireLaser(){
				if(shields<=0)return;
				var damage = Math.floor(laser*Math.random());
				enemy.s -= damage;
				if(damage == 0){
					output("your laser missed!");
				}
				else{
					output("you dealt " + damage + " laser damage to the " + enemy.n);
				}
				checkVictory();
			}

			function fireMissile(){
				if(missiles >= 1){
					missiles -= 1;
					enemy.s -= 5;
					output("Your missile did 5 damage to the " + enemy.n);
				}
				else{
					output("You are out of missiles.");
				}
				checkVictory();
			}

			function raiseShields(){
				var diff = Math.floor(Math.random()*(maxShields-shields));
				shields += diff;
				output("shields regenerated " + diff + " points.");
				retaliation();
			}
			function retreat(){
				if(confirm("Captain, starting the hyper drive now will make the damage to your shields pernament. Are you sure you want to retreat?")){
					document.cookie = "shields=" + shields + ";path=/";
					maxShields=shields;
					updateShip();
					output("You retreat from the battle.");
					document.getElementById("input").style.visibility = "hidden";
				}
			}
			function scan(){
				output("---BEGIN SCAN REPORT---");
				output("TARGET   : " + enemy.n);
				output("LASERS   : " + enemy.l);
				output("SHIELDS  : " + enemy.s);
				output("MISSILES : " + enemy.m);
				output("----END SCAN REPORT----")
				retaliation();
			}
			function retaliation(){
				var damage = Math.floor(enemy.l*Math.random());
				shields -= damage;
				if(damage == 0){
					output("enemy laser missed!");
				}
				else{
					output(enemy.n + " dealt " + damage + " damage to your ship.");
				}

				updateShip();
				if(shields<=0){
					output("Your ship has been wrecked. Game over.");
					document.getElementById("input").style.visibility = "hidden";
					document.cookie = "shields=0;path=/";
					document.cookie = "credits=0;path=/";
				}
			}

		</script>
	</body>
</html>
